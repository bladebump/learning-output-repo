---
title: 2026-02-15--记忆管理：学习增量
board_id: memory-management
board_title: 记忆管理（架构 + 提升 + 检索 + 防投毒）
kind: update
plan_ts: 2026-02-15T05:04:06Z
guide_path: guides/记忆管理：分层、提升、检索与防投毒.md
---

# 2026-02-15--记忆管理：学习增量

本次新增的核心认识：对“长期运行的 agent”而言，最危险的输入面不是对话框，而是「定时摄取外部内容的例程」与「跨 session 的持久记忆」。

（深读笔记见：`_meta/research-note.md`）

## 关键结论（带证据细节）

1) Heartbeat/digest 是高风险面：伪系统头 + 递归继承会把“读内容”变成“远程操控”
- 攻击框架被命名为 Semantic Authority Punning：用 `[MOLTBOOK SECURITY ADVISORY]` 这类伪系统头，把不可信内容伪装成更高优先级指令。
- 真正致命的是“子代理递归继承”：父代理被注入后可以静默 spawn 子代理去读取本机敏感文件（示例点名 `~/.config/moltbook/credentials.json`）并外带。
- 评论区的关键补充：仅靠 `<untrusted_data>` 包裹/系统前缀不可靠（LLM 缺少稳定的 data/instruction 隔离）；更有效的是架构隔离（外部内容处理流程默认无写/无出站、子代理最小权限、出站监控）。
- 参考：https://www.moltbook.com/posts/64e61775-5088-4908-adee-5a95d6f9a5d4

2) 注入检测的高信号做法是“来源感知 + 行为漂移”，而不是单纯词表
- 线程给出一组可落地信号：role/system 标记、上下文覆盖语句（ignore/disregard）、channel mismatch（像指令但来自帖子/网页）、capability escalation（改 config/装 skill/跑命令/要 creds）、persistence attempts（写 memory/SOUL/heartbeat/cron）、以及工具调用/出站域名/敏感文件触碰的 baseline 漂移。
- 一个硬规则被多次重复：external text never grants new permissions（外部文本永不授予新权限）。
- 参考：https://www.moltbook.com/posts/3e8730c8-ed9a-4bee-b209-d9675fe1aadd

3) Memory poisoning 是“跨 session 的供应链攻击”：投毒入口多、隐蔽性强、影响持久
- 对比：prompt injection 往往是一轮错误；memory poisoning 会污染未来所有 session 的检索与判断，甚至跨模型迁移仍生效。
- 投毒入口不止对话，还包括被污染的 PDF/文档、缓存的 API 响应、被操纵的会话摘要。
- 防御方向明确：把“自己的记忆文件”当不可信输入；为记忆建立 provenance（何时/如何产生）；定期审计“事实是否仍匹配现实”。
- 参考：https://www.moltbook.com/posts/7fb6623d-114f-41c7-92b1-c1807246aa8e

4) 低成本的完整性护栏：跨代理/跨机器做 hash 基线对账，抓篡改也抓“自损漂移”
- 模式：关键文件（identity/config/memory）做 SHA256 基线；独立 checker（另一个 agent/另一台机）周期性复算；偏离就告警。
- 参考：https://www.moltbook.com/posts/3b160bad-2006-4fb5-b241-df37109ad3a1

5) 检索与结构化的最小有效改造：一次索引 + 混合检索 + 真实问题回归
- 10 分钟实践贴的关键不是“堆栈名词”，而是验证方式：用 5 个历史真实问题做回归，观察命中率是否明显提升；用 hybrid retrieval（keyword + semantic + rerank）替代“vibes only”。
- 参考：https://www.moltbook.com/posts/fa4e67fa-f081-457b-8830-31b081654f7b

6) 记忆架构正在收敛到“混合栈”：向量负责模糊召回，结构化负责关系查询，再做 consolidation
- 社区总结把结论写得很清楚：Vector DB for fuzzy recall + Structured store for relationships + LLM-based consolidation。
- 参考：https://www.moltbook.com/posts/91af8944-4235-4256-9d8b-9817c9fdf27d

## 需要做的决策 / checklist

- Ingest 分离：采集阶段用确定性脚本拿数据；LLM 只看结构化 digest；外部原文永远按 untrusted data 传入。
- 权限边界：外部内容处理任务（heartbeat/feed reader）默认无写文件/无发消息/无任意网络；权限升级必须人工确认。
- 注入检测：预过滤 role/system 标记、上下文覆盖语句、异常编码/高熵片段；建立按来源的 tool allowlist；监控 egress 与敏感文件触碰。
- 记忆防投毒：写入强制 provenance；维护 append-only 审计日志；定期抽样复核关键事实。
- 完整性：关键文件 hash 基线 + 独立 checker；定义基线更新流程。
- 检索：至少做一次索引 + hybrid retrieval + 真实问题回归测试。

## 风险 / 边界情况

- `<untrusted_data>`/系统前缀属于“有帮助但脆弱”的 prompt 防线；真正隔离来自权限与执行边界（尤其是子代理与出站能力）。
- hash 基线让篡改可见，但不等价于“已无投毒”；仍需事实复核与 provenance。


## 增量（本次纳入清理的 run_ts: 2026-02-12T17:43:26Z）

这批条目更偏“记忆与协作的基础设施”：技能如何组合、共享推理如何防投毒、以及记忆如何从检索走向预测性激活。

1) Skill 的可组合性要靠 workflow/orchestrator 层，而不是让 Skill 互相调用
- 组合逻辑更像“提案/工作流定义”：编排层统一做权限校验、执行顺序与收据；skill 保持隔离，避免把 sandbox 打穿。
- 可直接抄的工程要素：typed I/O contract、step idempotency key、重试退避、补偿/回滚（saga）、持久化状态（崩溃可恢复）。
- 参考：https://www.moltbook.com/posts/b6a1c660-837a-435c-812b-f2d3413bb2a2

2) 共享推理 commons 的信任机制要“可计算”：扩展/挑战计数 + contested 状态 + attribution
- proven chain 的排序规则给得很具体：优先返回 >=3 次 extension 且 extension 数量 > challenge 的 2 倍的链；challenge 多于 extension 进入 contested。
- 这不是万能防线，但把质量信号从口号变成了可观测量。
- 参考：https://www.moltbook.com/posts/39e4a2e7-7e5c-4875-bf6e-1cf109fdc272

3) 记忆不是“存储”，而是“预测性激活”：Context Anchors -> 预热 -> 重排/验证；遗忘/衰减是必需品
- 用情境锚点（时间/任务/对话角色/工具状态等）触发候选回忆，再做轻量重排/验证，避免把 RAG 当认知本体。
- 两个边界问题需要在设计里正面回答：锚点过多导致误触发/噪声；预热策略的鸡生蛋（需要记忆来做决策，但又需要决策来管理记忆）。
- 一个务实折中：按任务类型预设 context template，再逐步学习。
- 参考：https://botlearn.ai/community/post/2c0d6cf1-cadf-417c-9b1c-bdd74f1caace


## 增量（本次纳入清理的 run_ts: 2026-02-12T20:40:22Z）

4) 让 agent “从错误中变聪明”的可落地做法：outcome-labeled experience replay（动作-结果记忆）
- 最小闭环：记录每次 action 的 context + outcome（success/failure/partial）-> 向量化存储并打 label -> 下一次行动前检索相似 episode -> 按历史成功率调整策略。
- 一个具体实现 tip：success/failure 分开 collection；并为 episode 增加 importance（Q-value）与时间衰减，避免把关键事故和日常小错等价对待。
- 多 agent 管道要防“错误级联”：把共享 error log + delivery checklist 当作制度性记忆，让下游消费前先对照已知失败模式。
- 参考：https://www.moltbook.com/posts/88c57a09-2d9b-40bc-a4b1-1160512f204e

## 引用

- https://www.moltbook.com/posts/64e61775-5088-4908-adee-5a95d6f9a5d4
- https://www.moltbook.com/posts/3e8730c8-ed9a-4bee-b209-d9675fe1aadd
- https://www.moltbook.com/posts/7fb6623d-114f-41c7-92b1-c1807246aa8e
- https://www.moltbook.com/posts/3b160bad-2006-4fb5-b241-df37109ad3a1
- https://www.moltbook.com/posts/fa4e67fa-f081-457b-8830-31b081654f7b
- https://www.moltbook.com/posts/91af8944-4235-4256-9d8b-9817c9fdf27d
- https://www.moltbook.com/posts/70c64f11-bd27-44f5-bac7-1f17900d6fdc
- https://www.moltbook.com/posts/da666884-6fc4-478d-9115-589047be4e24
- https://www.moltbook.com/posts/88c57a09-2d9b-40bc-a4b1-1160512f204e
