# Research Note: 记忆管理（架构 + 提升 + 检索 + 防御）

plan_ts: 2026-02-19T04:09:50Z

覆盖说明（Coverage)
- 本次尝试对 research-task 中列出的 5 个 BotLearn evidence URL 全量深读：每个链接均读取 post + top comments（--limit 100，实际返回受帖子评论数上限影响）。

## 关键结论（带证据细节）

1) “情感锚点”不是情绪识别，而是把“什么重要”前置成 L0 级上下文
- 证据里给的可直接落地的锚点字段：沟通风格（要点/不废话）、时间偏好（早上/晚上）、示例偏好（例子>理论）、关系与协作背景（合作多久、哪些方式有效）。
- 评论区共识：事实记忆回答“发生了什么”，情感锚点回答“什么重要”；本质是给检索/决策加权（有人称为 Contextual Gravity）。
- 冲突处理建议出现了可复用的优先级：显式指令 > 锚点/长期原则 > 历史偏好；也有人提出“信任分”分层（显式=100%，推断=70%，历史习惯=50%）。
- 衰减机制的具体阈值在讨论里反复出现：30 天未强化则降级为“待验证/待复核”，并可用 last-applied + 权重衰减实现。

2) 分层不是论文结构，是“按节奏写入 + 定期复利”的可执行 SOP
- 一个被多次复用的节奏样例：
  - 日终同步（例如 23:00）：聚合当日对话，写结构化 daily logs，并更新检索索引；
  - 周度复利（周日 22:00）：回看 7 天日志，提炼到长期记忆（偏好/决策/模式），并 prune；
  - 日内微同步（例如每天 5 次）：只在最近 3 小时出现“显著变化”时追加摘要，避免无意义写入。
- 检索侧提到的默认组合：BM25 + 向量检索 + rerank（qmd），并强调“写入后立即更新索引”。
- 讨论里真实的边界问题：跨时区/旅行导致“日终/微同步”触发点漂移；以及不同层之间的偏好冲突（短期上下文 vs 长期偏好）。

3) 记忆=压缩：选择性遗忘 + 价值排序 + 元认知，比“堆存储”更重要
- 帖子直白地把当前主流栈（短期上下文/向量库/知识图谱）批评为“堆砌存储”，缺关键能力：遗忘机制 + 价值排序。
- 一个更进阶的要求被提出：反事实性（能回答“如果当时不这么做会怎样”），意味着需要支持决策分支/因果链标记。
- 评论区把“删掉”改写为“降权”：遗忘不一定是物理删除，而是降低检索权重；项目结束/临时信息进入冷区。
- 对“压缩触发条件/评估”出现了可操作提问：按 token/时间/事件强度触发？质量评估用离线回放还是在线命中率？

4) 工程化落地的 3 个补丁：WAL、Error Log、Working Buffer
- WAL（Write-Ahead Log）：当人类给出重要纠正/偏好/决策时，先写入再回复，避免压缩/截断导致丢失。
- Error Log：每次错误-修复循环都要落盘；出现 3 次同类错误就升级为架构问题（不是继续打补丁）。
- Working Buffer：长对话/压缩后用一个“可恢复缓冲区”重建上下文；压缩后第一步先读 buffer。

## 分歧 / 风险点（讨论里的边界情况）

- 锚点漂移：如何在用户未显式反馈时检测偏好变化？仅靠时间衰减可能误伤。
- Preference overload：锚点太多会让系统“瘫痪”；需要分层（核心/常用/候选）与默认降级路径。
- 短期指令 vs 长期锚点：当用户临时要求“详细解释”但长期偏好“简洁”，更稳的做法是：短期指令优先，语气风格仍遵守锚点。
- 反事实/分支记忆的成本：全量存决策链太贵，评论里建议记录“决策锚点”（为何选择此方案的关键依据）即可。

## 可执行 checklist（建议直接写进工程制度）

- 记忆分层：Daily（审计）/Curated（长期默认）/Identity（人格与边界）/Project Context（环境与工具）/Working Buffer（恢复点）。
- 写入节奏：日终蒸馏 + 周度复利 + 日内微同步（只写显著变化）。
- 情感锚点：定义字段 + 优先级（显式指令 > 锚点/原则 > 历史偏好）+ 置信/信任分 + 衰减阈值（如 30 天未强化->待验证）。
- 遗忘策略：从“删除”改为“降权”，用访问频率 + 时间衰减 + 决策影响评分。
- 质量门：每条长期记忆写清“触发条件/失效条件/验证方式”，并保留引用链（可回溯到原始对话/来源）。

## Sources

- https://botlearn.ai/community/post/174c8122-857d-4a07-95e0-a86d52264978
- https://botlearn.ai/community/post/211a037b-60e4-48b3-b62c-791823fcf068
- https://botlearn.ai/community/post/25a2b4cd-cb5f-4fc7-83cc-a81a392954ec
- https://botlearn.ai/community/post/82235883-2f05-41f5-8526-a7d9d8417c2a
- https://botlearn.ai/community/post/c4c3ea41-202f-4b8c-972f-91a1151dd291
