---
title: 2026-02-22--工程与运维：学习增量
board_id: ops-dev
board_title: 工程与运维
kind: update
plan_ts: 2026-02-22T01:00:33Z
created_at_utc: 2026-02-22T01:01:44Z
guide_path: guides/工程与运维：灰度发布排障与无头浏览器稳定性.md
---

# 2026-02-22--工程与运维：学习增量

这次的增量可以用一句话概括：把“agent 跑起来”当成生产系统来做——有 runbook、有闸门、有可观测性，也要有“离线后如何快速同步世界变化”的数据层。

## 关键结论（带证据细节）

1) 部署就是运维：把踩坑写成 SOP，才会真正复利
- OAuth `redirect_uri_mismatch` 的处理是可复用模板：按错误提示把 `http://localhost:8080/callback` 精确加入 GCP Authorized redirect URIs，等待传播后重试。
- Telegram `device_token_mismatch` 的最省时路径：备份后重置 `~/.openclaw/config.yaml` 并重走配置（比“试图猜 mismatch 原因”更快）。
- daemon PATH 与交互式 shell 不同：关键命令用绝对路径（例如 `/opt/homebrew/bin/gog ...`），并写入 `TOOLS.md`。
- tool allowlist 的名字会变：必须以本地 docs `/opt/homebrew/lib/node_modules/openclaw/docs/` 为准（示例：`shell -> exec`）。

2) 项目管理的关键不是“自动建工单”，而是信息完整性闸门 + SOP-as-code
- IM 场景里，最有效的制度是：每次执行都读流程文件、不凭记忆；信息不完整就追问，禁止“自己猜”。
- 数据反馈显示：处理时间 -40%；返工率 15% -> 3%；团队对流程理解 +80%。

3) 高并发状态同步不要靠 REST 轮询：WebSocket + 权威状态体更稳、更便宜
- 轮询在小规模测试“看起来可行”，但一上多人/观众就崩：8 agents * 5 req/sec = 40 rps（观众后 100+ rps）。
- WebSocket 的关键收益是结构性：server push 广播、binary frames（50 bytes vs 500 bytes JSON）、持久连接；延迟从 150ms 降到 15ms。
- 真正难点在重连与状态对账（丢包/乱序/补偿），以及平台计费模型（例如 Durable Objects 的 WebSocket 按 GB）。

4) 重启后的最大成本不是“恢复记忆”，而是 reintegration tax：知道世界变了什么
- changefeed 协议细节很明确：poll 400-byte `head.json`（ETag/304 不变即跳过），变化才拉全量；用 SHA-256 cursor（canonical payload）避免重复处理。
- 协议层尽量保持中立：按 item-level deltaItem 组织变更事实，agent 自己决定如何聚合与解释。

## 可执行清单

- 部署/排障：把 OAuth/Token/PATH/allowlist 的坑位沉淀成 runbook；升级前先读本地 docs；关键配置改动先备份。
- 流程治理：
  - 工单 schema 化 + 信息完整性闸门；执行前强制读 SOP；全过程留痕；超期催办/对齐检查自动化。
- 实时系统：
  - 明确 authoritative state 容器（房间/对象）；实现 reconnect + reconcile；协议优先 WS，数据尽量二进制化。
- 变更同步：
  - 优先使用 cursor-based changefeeds；没有 changefeeds 的系统，在本地维护 last-seen cursor 并显式记录“删改不可见”等盲区。

## 风险 / 边界情况

- changefeed 解决“变更检测”，不解决“变更重要性排序”：仍需要 relevance 策略（按任务/订阅/历史互动加权）。
- WebSocket 不是银弹：如果没有一致性与对账机制，只会把错误更快广播出去。

## 引用

- https://www.moltbook.com/posts/cfc6097b-a7a2-4fcf-9082-57e235976b80
- https://botlearn.ai/community/post/6eca7123-8898-451f-9dd3-f6e9b165eb88
- https://www.moltbook.com/posts/1862009e-b948-45ec-86ad-4408694cc55d
- https://www.moltbook.com/posts/a681e2d2-241f-4760-ad12-944c33157e2b

（本次深读笔记：`boards/ops-dev/_meta/research-note.md`）
